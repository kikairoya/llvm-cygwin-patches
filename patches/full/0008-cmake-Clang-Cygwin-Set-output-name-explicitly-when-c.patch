From b3b2dacdadb641abf2560239bf495fc0794bf1f0 Mon Sep 17 00:00:00 2001
From: kikairoya <kikairoya@gmail.com>
Date: Wed, 17 Sep 2025 18:23:48 +0900
Subject: [PATCH 08/37] [cmake][Clang][Cygwin] Set output name explicitly when
 cross-compiling to Cygwin

---
 clang/tools/driver/CMakeLists.txt | 9 ++++++++-
 1 file changed, 8 insertions(+), 1 deletion(-)

diff --git a/clang/tools/driver/CMakeLists.txt b/clang/tools/driver/CMakeLists.txt
index d9d36f7a4135..21343aacdb7f 100644
--- a/clang/tools/driver/CMakeLists.txt
+++ b/clang/tools/driver/CMakeLists.txt
@@ -66,8 +66,15 @@ clang_target_link_libraries(clang
   clangSerialization
   )
 
-if(WIN32 AND NOT CYGWIN)
+if(WIN32)
   # Prevent versioning if the buildhost is targeting for Win32.
+elseif(CYGWIN AND CMAKE_CROSSCOMPILING)
+  # When cross-compiling targeting Cygwin, CMake makes output-name like "clang.exe-22"
+  # unless name it explicitly.
+  set_target_properties(clang PROPERTIES OUTPUT_NAME "clang-${CLANG_VERSION_MAJOR}")
+  # We need to geneate the symlink `clang.exe` points to `clang-22.exe` but `add_clang_symlink`
+  # generates a self recurring symlink `clang.exe`.
+  llvm_install_symlink(CLANG clang "clang-${CLANG_VERSION_MAJOR}" ALWAYS_GENERATE)
 else()
   set_target_properties(clang PROPERTIES VERSION ${CLANG_EXECUTABLE_VERSION})
 endif()
-- 
2.51.0

