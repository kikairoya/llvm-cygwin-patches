From 12ef670dfdc55990bf2d65ae3ad3b6bdda4c0e16 Mon Sep 17 00:00:00 2001
From: kikairoya <kikairoya@gmail.com>
Date: Fri, 5 Dec 2025 19:56:11 +0900
Subject: [PATCH 69/69] [Plugin][unittest] Disable unittests for plugin when
 BUILD_SHARED_LIBS on Windows

---
 llvm/unittests/Analysis/PluginInlineAdvisorAnalysisTest.cpp | 4 +++-
 llvm/unittests/Analysis/PluginInlineOrderAnalysisTest.cpp   | 4 +++-
 2 files changed, 6 insertions(+), 2 deletions(-)

diff --git a/llvm/unittests/Analysis/PluginInlineAdvisorAnalysisTest.cpp b/llvm/unittests/Analysis/PluginInlineAdvisorAnalysisTest.cpp
index aaafaabe773ebaf9cb0de3569a8c0ce82568f84b..c752083acbde60f6a94ef56f96805fb2fa57e77d 100644
--- a/llvm/unittests/Analysis/PluginInlineAdvisorAnalysisTest.cpp
+++ b/llvm/unittests/Analysis/PluginInlineAdvisorAnalysisTest.cpp
@@ -245,7 +245,9 @@ define i32 @fib_check(){
 // check that loading a plugin works
 // the plugin being loaded acts identically to the default inliner
 TEST(PluginInlineAdvisorTest, PluginLoad) {
-#if !defined(LLVM_ENABLE_PLUGINS)
+#if !defined(LLVM_ENABLE_PLUGINS) ||                                           \
+    ((defined(_WIN32) || defined(__CYGWIN__)) &&                               \
+     defined(LLVM_BUILD_SHARED_LIBS))
   // Skip the test if plugins are disabled.
   GTEST_SKIP();
 #endif
diff --git a/llvm/unittests/Analysis/PluginInlineOrderAnalysisTest.cpp b/llvm/unittests/Analysis/PluginInlineOrderAnalysisTest.cpp
index 48f7bb0117a0d7b873a237955686a3320779c224..45dd75081c800ca52855a911a28d3a185190723e 100644
--- a/llvm/unittests/Analysis/PluginInlineOrderAnalysisTest.cpp
+++ b/llvm/unittests/Analysis/PluginInlineOrderAnalysisTest.cpp
@@ -223,7 +223,9 @@ define i32 @fib_check(){
 // The custom order drops any functions named "foo" so all tests
 // should contain at least one function named foo.
 TEST(PluginInlineOrderTest, NoInlineFoo) {
-#if !defined(LLVM_ENABLE_PLUGINS)
+#if !defined(LLVM_ENABLE_PLUGINS) ||                                           \
+    ((defined(_WIN32) || defined(__CYGWIN__)) &&                               \
+     defined(LLVM_BUILD_SHARED_LIBS))
   // Skip the test if plugins are disabled.
   GTEST_SKIP();
 #endif
-- 
2.52.0

