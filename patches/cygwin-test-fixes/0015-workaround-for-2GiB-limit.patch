From f77d8f403e467ad6333b69232b86e980c047d9f8 Mon Sep 17 00:00:00 2001
From: kikairoya <kikairoya@gmail.com>
Date: Sun, 21 Sep 2025 09:57:11 +0900
Subject: [PATCH 15/56] workaround for 2GiB limit

---
 clang/unittests/CMakeLists.txt             | 4 ++++
 clang/unittests/Interpreter/CMakeLists.txt | 4 ++++
 2 files changed, 8 insertions(+)

diff --git a/clang/unittests/CMakeLists.txt b/clang/unittests/CMakeLists.txt
index 438a5c4c2e711f16980a1bd19902a90d8f193d5a..4bc1d01362fc0919072269786612ecdfdebd0925 100644
--- a/clang/unittests/CMakeLists.txt
+++ b/clang/unittests/CMakeLists.txt
@@ -127,6 +127,10 @@ add_distinct_clang_unittest(AllClangUnitTests
   ${LLVM_COMPONENTS}
 )
 
+if ((MINGW OR CYGWIN) AND NOT (CLANG_LINK_CLANG_DYLIB OR BUILD_SHARED_LIBS))
+  target_link_options(AllClangUnitTests PRIVATE "-S")
+endif()
+
 # The Tooling library has some internal headers. Make those work. If we like
 # the merged clang unit test binary, we can update the include paths and make
 # this the default.
diff --git a/clang/unittests/Interpreter/CMakeLists.txt b/clang/unittests/Interpreter/CMakeLists.txt
index 66b396b53cb55b728eeb4eb9531c1d0ca4f7e3dc..93813577b748dbf28b0a702bdbd120431b3c9134 100644
--- a/clang/unittests/Interpreter/CMakeLists.txt
+++ b/clang/unittests/Interpreter/CMakeLists.txt
@@ -92,6 +92,10 @@ set_target_properties(ClangReplInterpreterTests PROPERTIES
 )
 endif()
 
+if ((MINGW OR CYGWIN) AND NOT (CLANG_LINK_CLANG_DYLIB OR BUILD_SHARED_LIBS))
+  target_link_options(ClangReplInterpreterTests PRIVATE "-S")
+endif()
+
 # Exceptions on Windows are not yet supported.
 if(NOT WIN32)
   add_subdirectory(ExceptionTests)
-- 
2.51.2

