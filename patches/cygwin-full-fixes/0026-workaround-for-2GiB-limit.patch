From bc3c6e349455c3e317d55902e864855be6ea5f13 Mon Sep 17 00:00:00 2001
From: kikairoya <kikairoya@gmail.com>
Date: Sun, 21 Sep 2025 09:57:11 +0900
Subject: [PATCH 26/54] workaround for 2GiB limit

---
 clang/unittests/CMakeLists.txt             | 4 ++++
 clang/unittests/Interpreter/CMakeLists.txt | 4 ++++
 2 files changed, 8 insertions(+)

diff --git a/clang/unittests/CMakeLists.txt b/clang/unittests/CMakeLists.txt
index 438a5c4c2e711f16980a1bd19902a90d8f193d5a..3b487232976e9d5d6553fbb9b726ca49102d30c8 100644
--- a/clang/unittests/CMakeLists.txt
+++ b/clang/unittests/CMakeLists.txt
@@ -127,6 +127,10 @@ add_distinct_clang_unittest(AllClangUnitTests
   ${LLVM_COMPONENTS}
 )
 
+if ((MINGW OR CYGWIN) AND NOT (CLANG_LINK_CLANG_DYLIB OR BUILD_SHARED_LIBS))
+  target_link_options(AllClangUnitTests PRIVATE "-Wl,-S")
+endif()
+
 # The Tooling library has some internal headers. Make those work. If we like
 # the merged clang unit test binary, we can update the include paths and make
 # this the default.
diff --git a/clang/unittests/Interpreter/CMakeLists.txt b/clang/unittests/Interpreter/CMakeLists.txt
index 66b396b53cb55b728eeb4eb9531c1d0ca4f7e3dc..62c8f215dc98cea3b20e7e066752e7f0ed176f39 100644
--- a/clang/unittests/Interpreter/CMakeLists.txt
+++ b/clang/unittests/Interpreter/CMakeLists.txt
@@ -92,6 +92,10 @@ set_target_properties(ClangReplInterpreterTests PROPERTIES
 )
 endif()
 
+if ((MINGW OR CYGWIN) AND NOT (CLANG_LINK_CLANG_DYLIB OR BUILD_SHARED_LIBS))
+  target_link_options(ClangReplInterpreterTests PRIVATE "-Wl,-S")
+endif()
+
 # Exceptions on Windows are not yet supported.
 if(NOT WIN32)
   add_subdirectory(ExceptionTests)
-- 
2.52.0

