From 389cc1a002c431bd3ee6a21c840e2d1be5f68ebb Mon Sep 17 00:00:00 2001
From: kikairoya <kikairoya@gmail.com>
Date: Sun, 9 Nov 2025 21:00:27 +0900
Subject: [PATCH 27/66] always specify `.exe.a` for the suffix of import
 library

needs for LLVM_BUILD_LLVM_DYLIB
---
 llvm/cmake/modules/AddLLVM.cmake | 15 ++++++++-------
 1 file changed, 8 insertions(+), 7 deletions(-)

diff --git a/llvm/cmake/modules/AddLLVM.cmake b/llvm/cmake/modules/AddLLVM.cmake
index d6acb4f984be92246bdbb1fb329c310d6e0d2cee..8d1e47089348a1125cf3c2d83fe95172929f1696 100644
--- a/llvm/cmake/modules/AddLLVM.cmake
+++ b/llvm/cmake/modules/AddLLVM.cmake
@@ -1076,6 +1076,14 @@ macro(add_llvm_executable name)
     add_llvm_symbol_exports( ${name} ${LLVM_EXPORTED_SYMBOL_FILE} )
   endif(LLVM_EXPORTED_SYMBOL_FILE)
 
+  # The default import library suffix that cmake uses for cygwin/mingw is
+  # ".dll.a", but for clang.exe that causes a collision with libclang.dll,
+  # where the import libraries of both get named libclang.dll.a. Use a suffix
+  # of ".exe.a" to avoid this.
+  if(CYGWIN OR MINGW)
+    set_target_properties(${name} PROPERTIES IMPORT_SUFFIX ".exe.a")
+  endif()
+
   if (DEFINED LLVM_ENABLE_EXPORTED_SYMBOLS_IN_EXECUTABLES AND
       NOT LLVM_ENABLE_EXPORTED_SYMBOLS_IN_EXECUTABLES AND
       NOT ARG_EXPORT_SYMBOLS)
@@ -1376,13 +1384,6 @@ function(export_executable_symbols target)
     # transitive link against only the libraries whose symbols
     # we aren't exporting.
     set_target_properties(${target} PROPERTIES INTERFACE_LINK_LIBRARIES "${other_libs}")
-    # The default import library suffix that cmake uses for cygwin/mingw is
-    # ".dll.a", but for clang.exe that causes a collision with libclang.dll,
-    # where the import libraries of both get named libclang.dll.a. Use a suffix
-    # of ".exe.a" to avoid this.
-    if(CYGWIN OR MINGW)
-      set_target_properties(${target} PROPERTIES IMPORT_SUFFIX ".exe.a")
-    endif()
   elseif(NOT (WIN32 OR CYGWIN))
     # On Windows auto-exporting everything doesn't work because of the limit on
     # the size of the exported symbol table, but on other platforms we can do
-- 
2.52.0

