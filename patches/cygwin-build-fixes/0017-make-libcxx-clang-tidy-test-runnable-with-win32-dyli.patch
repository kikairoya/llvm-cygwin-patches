From 5611fcfd24ed6609daf692728b2ab28ecdd00e47 Mon Sep 17 00:00:00 2001
From: kikairoya <kikairoya@gmail.com>
Date: Sun, 14 Dec 2025 00:23:16 +0900
Subject: [PATCH 17/19] make libcxx clang-tidy test runnable with win32 dylib
 builds

---
 libcxx/test/tools/clang_tidy_checks/CMakeLists.txt | 4 +++-
 libcxx/utils/libcxx/test/params.py                 | 2 ++
 2 files changed, 5 insertions(+), 1 deletion(-)

diff --git a/libcxx/test/tools/clang_tidy_checks/CMakeLists.txt b/libcxx/test/tools/clang_tidy_checks/CMakeLists.txt
index 521a60c0fc498f861ecba11026bc3a26d0ca5737..b55ec2477619d2d25ada5f2e09781e12d33c304d 100644
--- a/libcxx/test/tools/clang_tidy_checks/CMakeLists.txt
+++ b/libcxx/test/tools/clang_tidy_checks/CMakeLists.txt
@@ -29,7 +29,9 @@ set(CMAKE_CXX_STANDARD 20)
 
 # Link only against clangTidy itself, not anything that clangTidy uses; otherwise we run setup code multiple times
 # which results in clang-tidy crashing
-set_target_properties(clangTidy PROPERTIES INTERFACE_LINK_LIBRARIES "")
+if(NOT (WIN32 OR CYGWIN))
+  set_target_properties(clangTidy PROPERTIES INTERFACE_LINK_LIBRARIES "")
+endif()
 # ClangTargets.cmake doesn't set the include paths, so we have to do it
 target_include_directories(clangTidy INTERFACE
                            ${CLANG_INCLUDE_DIRS}
diff --git a/libcxx/utils/libcxx/test/params.py b/libcxx/utils/libcxx/test/params.py
index d0bb38ab84df496228b295702b2a1a6f6de1ab65..32cf6a7ae505a3de6301507a20d37d16a4a3fc38 100644
--- a/libcxx/utils/libcxx/test/params.py
+++ b/libcxx/utils/libcxx/test/params.py
@@ -8,6 +8,7 @@
 import sys
 import re
 import shlex
+import shutil
 from pathlib import Path
 
 from libcxx.test.dsl import *
@@ -124,6 +125,7 @@ def getSizeOptimizationFlag(cfg):
 
 def testClangTidy(cfg, version, executable):
     try:
+        executable = shutil.which(executable)
         if version in commandOutput(cfg, [f"{executable} --version"]):
             return executable
     except ConfigurationRuntimeError:
-- 
2.52.0

