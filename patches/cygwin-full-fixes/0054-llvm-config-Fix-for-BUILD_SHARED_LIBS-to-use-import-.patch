From 9ade0baea58ecd15279ba278bbcf9192024315ab Mon Sep 17 00:00:00 2001
From: kikairoya <kikairoya@gmail.com>
Date: Fri, 5 Dec 2025 19:55:10 +0900
Subject: [PATCH 54/54] [llvm-config] Fix for BUILD_SHARED_LIBS to use import
 libraries instead of DLLs directly

---
 llvm/tools/llvm-config/llvm-config.cpp | 15 +++++++--------
 1 file changed, 7 insertions(+), 8 deletions(-)

diff --git a/llvm/tools/llvm-config/llvm-config.cpp b/llvm/tools/llvm-config/llvm-config.cpp
index 5300c5c83e5ce3923fe02ba7f250663f0e131058..a0e3dc03e4b0f4c43feecd1d9c485d9b38e7584c 100644
--- a/llvm/tools/llvm-config/llvm-config.cpp
+++ b/llvm/tools/llvm-config/llvm-config.cpp
@@ -383,18 +383,18 @@ int main(int argc, char **argv) {
   /// in the first place. This can't be done at configure/build time.
 
   StringRef SharedExt, SharedVersionedExt, SharedDir, SharedPrefix, StaticExt,
-      StaticPrefix, StaticDir = "lib";
+      StaticPrefix, StaticDir;
   std::string DirSep = "/";
   const Triple HostTriple(Triple::normalize(LLVM_HOST_TRIPLE));
   if (HostTriple.isOSWindows()) {
-    SharedExt = "dll";
-    SharedVersionedExt = LLVM_DYLIB_VERSION ".dll";
     if (HostTriple.isOSCygMing()) {
-      SharedPrefix = LLVM_SHARED_LIBRARY_PREFIX;
+      SharedExt = "dll.a";
+      SharedVersionedExt = LLVM_DYLIB_VERSION ".dll.a";
       StaticExt = "a";
-      StaticPrefix = "lib";
+      SharedPrefix = StaticPrefix = "lib";
     } else {
-      StaticExt = "lib";
+      SharedVersionedExt = LLVM_DYLIB_VERSION ".lib";
+      SharedExt = StaticExt = "lib";
       DirSep = "\\";
       llvm::replace(ActiveObjRoot, '/', '\\');
       llvm::replace(ActivePrefix, '/', '\\');
@@ -405,8 +405,7 @@ int main(int argc, char **argv) {
       for (auto &Include : ActiveIncludeOptions)
         llvm::replace(Include, '/', '\\');
     }
-    SharedDir = ActiveBinDir;
-    StaticDir = ActiveLibDir;
+    SharedDir = StaticDir = ActiveLibDir;
   } else if (HostTriple.isOSDarwin()) {
     SharedExt = "dylib";
     SharedVersionedExt = LLVM_DYLIB_VERSION ".dylib";
-- 
2.52.0

