From 17966e5a21421b9eea5168efa2fbe8ef75a16c3f Mon Sep 17 00:00:00 2001
From: kikairoya <kikairoya@gmail.com>
Date: Thu, 27 Nov 2025 19:28:00 +0900
Subject: [PATCH 13/60] add `isCompatibleWithMSVC(void)` and use it

---
 clang/include/clang/Basic/LangOptions.h | 2 ++
 clang/lib/Sema/SemaDeclCXX.cpp          | 2 +-
 2 files changed, 3 insertions(+), 1 deletion(-)

diff --git a/clang/include/clang/Basic/LangOptions.h b/clang/include/clang/Basic/LangOptions.h
index 8aa89d8c8c8078078377dd3676297bd3e32e67dd..14a6c55c3f8f7bfb9011bc57a225e49140b805ca 100644
--- a/clang/include/clang/Basic/LangOptions.h
+++ b/clang/include/clang/Basic/LangOptions.h
@@ -623,6 +623,8 @@ public:
            !ObjCSubscriptingLegacyRuntime;
   }
 
+  bool isCompatibleWithMSVC() const { return MSCompatibilityVersion > 0; }
+
   bool isCompatibleWithMSVC(MSVCMajorVersion MajorVersion) const {
     return MSCompatibilityVersion >= MajorVersion * 100000U;
   }
diff --git a/clang/lib/Sema/SemaDeclCXX.cpp b/clang/lib/Sema/SemaDeclCXX.cpp
index 5f741166d0e29e525d95861ee4b9817d3a465334..f7b71cbb1bb20b1a5b08e4900b2a8b1a631eac87 100644
--- a/clang/lib/Sema/SemaDeclCXX.cpp
+++ b/clang/lib/Sema/SemaDeclCXX.cpp
@@ -6627,7 +6627,7 @@ void Sema::checkClassLevelDLLAttribute(CXXRecordDecl *Class) {
         auto *Ctor = dyn_cast<CXXConstructorDecl>(MD);
         if ((MD->isMoveAssignmentOperator() ||
              (Ctor && Ctor->isMoveConstructor())) &&
-            getLangOpts().isCompatibleWithMSVC(LangOptions::MSVC2010) &&
+            getLangOpts().isCompatibleWithMSVC() &&
             !getLangOpts().isCompatibleWithMSVC(LangOptions::MSVC2015))
           continue;
 
-- 
2.51.2

