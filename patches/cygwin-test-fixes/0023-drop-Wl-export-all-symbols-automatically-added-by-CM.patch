From 4c908de19d49a169e054d5d258be754bf6232f80 Mon Sep 17 00:00:00 2001
From: kikairoya <kikairoya@gmail.com>
Date: Mon, 3 Nov 2025 17:11:21 +0900
Subject: [PATCH 23/49] drop -Wl,--export-all-symbols automatically added by
 CMake

---
 llvm/CMakeLists.txt | 9 +++++++++
 1 file changed, 9 insertions(+)

diff --git a/llvm/CMakeLists.txt b/llvm/CMakeLists.txt
index c02c75f10b12f02b4133fc503cb0c23a586b394a..02666a7d05acb6b1f9afe9495e80168c6cedcdf0 100644
--- a/llvm/CMakeLists.txt
+++ b/llvm/CMakeLists.txt
@@ -1303,6 +1303,15 @@ endif( "${CMAKE_SYSTEM_NAME}" MATCHES SunOS )
 # use EXPORT_SYMBOLS argument.
 set(CMAKE_SHARED_LIBRARY_LINK_CXX_FLAGS "")
 
+if (CYGWIN AND LLVM_EXPORT_SYMBOLS_FOR_PLUGINS)
+  # CMake sets CMAKE_EXE_EXPORTS_${lang}_FLAG to `-Wl,--export-all-symbols`
+  # for Cygwin. This is incompatible with LLVM_EXPORT_SYMBOLS_FOR_PLUGINS
+  # tweaks, so unset them.
+  set(CMAKE_EXE_EXPORTS_ASM_FLAG "")
+  set(CMAKE_EXE_EXPORTS_C_FLAG "")
+  set(CMAKE_EXE_EXPORTS_CXX_FLAG "")
+endif()
+
 include(AddLLVM)
 include(TableGen)
 
-- 
2.51.2

