From 5f14588695bd833e8987011212589bd07521a152 Mon Sep 17 00:00:00 2001
From: kikairoya <kikairoya@gmail.com>
Date: Fri, 5 Dec 2025 19:56:11 +0900
Subject: [PATCH 63/63] [Plugin][unittest] Disable unittests for plugin when
 BUILD_SHARED_LIBS on Windows

---
 llvm/unittests/Analysis/PluginInlineAdvisorAnalysisTest.cpp | 4 +++-
 llvm/unittests/Analysis/PluginInlineOrderAnalysisTest.cpp   | 4 +++-
 2 files changed, 6 insertions(+), 2 deletions(-)

diff --git a/llvm/unittests/Analysis/PluginInlineAdvisorAnalysisTest.cpp b/llvm/unittests/Analysis/PluginInlineAdvisorAnalysisTest.cpp
index ca4ea8b627e839bfde810a3e9b09049d99b98e21..de3a58a302b325d1389c4099f9f3552cadb9155b 100644
--- a/llvm/unittests/Analysis/PluginInlineAdvisorAnalysisTest.cpp
+++ b/llvm/unittests/Analysis/PluginInlineAdvisorAnalysisTest.cpp
@@ -245,7 +245,9 @@ define i32 @fib_check(){
 // check that loading a plugin works
 // the plugin being loaded acts identically to the default inliner
 TEST(PluginInlineAdvisorTest, PluginLoad) {
-#if !defined(LLVM_ENABLE_PLUGINS)
+#if !defined(LLVM_ENABLE_PLUGINS) ||                                           \
+    ((defined(_WIN32) || defined(__CYGWIN__)) &&                               \
+     defined(LLVM_BUILD_SHARED_LIBS))
   // Skip the test if plugins are disabled.
   GTEST_SKIP();
 #endif
diff --git a/llvm/unittests/Analysis/PluginInlineOrderAnalysisTest.cpp b/llvm/unittests/Analysis/PluginInlineOrderAnalysisTest.cpp
index 0b31b0892d75aea5aa42a6dc5c1b4927bf693635..6d03dad75b380e2b4f855dc0f1f03de96ba86844 100644
--- a/llvm/unittests/Analysis/PluginInlineOrderAnalysisTest.cpp
+++ b/llvm/unittests/Analysis/PluginInlineOrderAnalysisTest.cpp
@@ -223,7 +223,9 @@ define i32 @fib_check(){
 // The custom order drops any functions named "foo" so all tests
 // should contain at least one function named foo.
 TEST(PluginInlineOrderTest, NoInlineFoo) {
-#if !defined(LLVM_ENABLE_PLUGINS)
+#if !defined(LLVM_ENABLE_PLUGINS) ||                                           \
+    ((defined(_WIN32) || defined(__CYGWIN__)) &&                               \
+     defined(LLVM_BUILD_SHARED_LIBS))
   // Skip the test if plugins are disabled.
   GTEST_SKIP();
 #endif
-- 
2.51.2

