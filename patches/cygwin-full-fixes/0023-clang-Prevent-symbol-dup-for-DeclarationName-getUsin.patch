From 1a1da60ad253acd1d85dc19e964274bd00f1a81c Mon Sep 17 00:00:00 2001
From: kikairoya <kikairoya@gmail.com>
Date: Fri, 5 Dec 2025 20:03:35 +0900
Subject: [PATCH 23/54] [clang] Prevent symbol dup for
 DeclarationName::getUsingDirectiveName

---
 clang/include/clang/AST/DeclarationName.h | 9 ++-------
 clang/lib/AST/DeclarationName.cpp         | 7 +++++++
 2 files changed, 9 insertions(+), 7 deletions(-)

diff --git a/clang/include/clang/AST/DeclarationName.h b/clang/include/clang/AST/DeclarationName.h
index a7185f5bce04bff828f7f38edcaae37ac1a0b84f..227a9c71fade5cf15dab0f0eb99d1f0034861874 100644
--- a/clang/include/clang/AST/DeclarationName.h
+++ b/clang/include/clang/AST/DeclarationName.h
@@ -19,10 +19,10 @@
 #include "clang/Basic/OperatorKinds.h"
 #include "clang/Basic/PartialDiagnostic.h"
 #include "clang/Basic/SourceLocation.h"
+#include "clang/Support/Compiler.h"
 #include "llvm/ADT/DenseMapInfo.h"
 #include "llvm/ADT/FoldingSet.h"
 #include "llvm/ADT/STLExtras.h"
-#include "llvm/Support/Compiler.h"
 #include "llvm/Support/type_traits.h"
 #include <cassert>
 #include <cstdint>
@@ -366,12 +366,7 @@ public:
       : Ptr(reinterpret_cast<uintptr_t>(Sel.InfoPtr.getOpaqueValue())) {}
 
   /// Returns the name for all C++ using-directives.
-  static DeclarationName getUsingDirectiveName() {
-    // Single instance of DeclarationNameExtra for using-directive
-    static detail::DeclarationNameExtra UDirExtra(
-        detail::DeclarationNameExtra::CXXUsingDirective);
-    return DeclarationName(&UDirExtra);
-  }
+  CLANG_ABI static DeclarationName getUsingDirectiveName();
 
   /// Evaluates true when this declaration name is non-empty.
   explicit operator bool() const {
diff --git a/clang/lib/AST/DeclarationName.cpp b/clang/lib/AST/DeclarationName.cpp
index 9a89a66f3f63aa44a0dbc3661a33734945062005..84ea72e645b42793383aea3f761b78ee75a6b9d8 100644
--- a/clang/lib/AST/DeclarationName.cpp
+++ b/clang/lib/AST/DeclarationName.cpp
@@ -37,6 +37,13 @@
 
 using namespace clang;
 
+DeclarationName DeclarationName::getUsingDirectiveName() {
+  // Single instance of DeclarationNameExtra for using-directive
+  static detail::DeclarationNameExtra UDirExtra(
+      detail::DeclarationNameExtra::CXXUsingDirective);
+  return DeclarationName(&UDirExtra);
+}
+
 static int compareInt(unsigned A, unsigned B) {
   return (A < B ? -1 : (A > B ? 1 : 0));
 }
-- 
2.52.0

