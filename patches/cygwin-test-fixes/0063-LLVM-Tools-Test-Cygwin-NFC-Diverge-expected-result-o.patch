From e57fcd97e786e5863dd54515e42657e2c0f9e256 Mon Sep 17 00:00:00 2001
From: kikairoya <kikairoya@gmail.com>
Date: Sat, 7 Jun 2025 18:02:39 +0900
Subject: [PATCH 63/66] [LLVM-Tools][Test][Cygwin](NFC) Diverge expected result
 on Cygwin host

---
 llvm/test/tools/llvm-ar/error-opening-permission.test          | 2 +-
 .../tools/llvm-dwarfutil/ELF/X86/mirror-permissions-unix.test  | 2 +-
 llvm/test/tools/llvm-ifs/fail-file-write.test                  | 2 +-
 llvm/test/tools/llvm-lipo/create-executable.test               | 2 +-
 .../test/tools/llvm-lipo/thin-executable-universal-binary.test | 2 +-
 llvm/test/tools/llvm-objcopy/ELF/mirror-permissions-unix.test  | 2 +-
 llvm/test/tools/llvm-objcopy/ELF/respect-umask.test            | 2 +-
 llvm/test/tools/llvm-objcopy/ELF/strip-preserve-atime.test     | 2 +-
 llvm/test/tools/llvm-ranlib/error-opening-permission.test      | 2 +-
 llvm/test/tools/llvm-rc/windres-preproc.test                   | 3 +++
 10 files changed, 12 insertions(+), 9 deletions(-)

diff --git a/llvm/test/tools/llvm-ar/error-opening-permission.test b/llvm/test/tools/llvm-ar/error-opening-permission.test
index b42f95329a3c711590c64dad6d6b369548261c49..f48d5a7e08df16cb3403321078d7a99fe5f604ee 100644
--- a/llvm/test/tools/llvm-ar/error-opening-permission.test
+++ b/llvm/test/tools/llvm-ar/error-opening-permission.test
@@ -1,6 +1,6 @@
 ## Unsupported on windows as marking files "unreadable"
 ## is non-trivial on windows.
-# UNSUPPORTED: system-windows
+# UNSUPPORTED: system-windows, system-cygwin
 # REQUIRES: non-root-user
 
 # RUN: rm -rf %t && mkdir -p %t
diff --git a/llvm/test/tools/llvm-dwarfutil/ELF/X86/mirror-permissions-unix.test b/llvm/test/tools/llvm-dwarfutil/ELF/X86/mirror-permissions-unix.test
index fdcba4dcd666b0dd97b2b0dedcec25d047cc9314..f2ce4a5c53c37fa8909c644c1e8175c423a39188 100644
--- a/llvm/test/tools/llvm-dwarfutil/ELF/X86/mirror-permissions-unix.test
+++ b/llvm/test/tools/llvm-dwarfutil/ELF/X86/mirror-permissions-unix.test
@@ -2,7 +2,7 @@
 ## llvm-dwarfutil respects the umask in setting output permissions.
 ## Setting the umask to 0 ensures deterministic permissions across
 ## test environments.
-# UNSUPPORTED: system-windows
+# UNSUPPORTED: system-windows, system-cygwin
 
 # RUN: touch %t
 # RUN: chmod 0777 %t
diff --git a/llvm/test/tools/llvm-ifs/fail-file-write.test b/llvm/test/tools/llvm-ifs/fail-file-write.test
index f13500f22620593e4eaf25fb140f6e5a51dead73..0eb7a127a425940448c51709cc36c7f74ec3a762 100644
--- a/llvm/test/tools/llvm-ifs/fail-file-write.test
+++ b/llvm/test/tools/llvm-ifs/fail-file-write.test
@@ -1,6 +1,6 @@
 ## Test failing to write output file on non-windows platforms.
 
-# UNSUPPORTED: system-windows
+# UNSUPPORTED: system-windows, system-cygwin
 # REQUIRES: non-root-user
 # RUN: rm -rf %t.TestDir
 # RUN: mkdir %t.TestDir
diff --git a/llvm/test/tools/llvm-lipo/create-executable.test b/llvm/test/tools/llvm-lipo/create-executable.test
index db785a5e4de2ab95881b3397b5ca0750041cb471..6414eeeaf92c6b83fe5e2611ca485881f3a68037 100644
--- a/llvm/test/tools/llvm-lipo/create-executable.test
+++ b/llvm/test/tools/llvm-lipo/create-executable.test
@@ -1,5 +1,5 @@
 # Executable testing is not supported on Windows, since all files are considered executable
-# UNSUPPORTED: system-windows
+# UNSUPPORTED: system-windows, system-cygwin
 # RUN: yaml2obj %p/Inputs/i386-slice.yaml -o %t-i386.o
 # RUN: yaml2obj %p/Inputs/x86_64-slice.yaml -o %t-x86_64.o
 
diff --git a/llvm/test/tools/llvm-lipo/thin-executable-universal-binary.test b/llvm/test/tools/llvm-lipo/thin-executable-universal-binary.test
index 40cf9cc7eab968e47e088a65adfd35972111a012..8bdefd2abec4971d2fb5af2a8c8b49652da76c48 100644
--- a/llvm/test/tools/llvm-lipo/thin-executable-universal-binary.test
+++ b/llvm/test/tools/llvm-lipo/thin-executable-universal-binary.test
@@ -1,5 +1,5 @@
 # Executable testing is not supported on Windows, since all files are considered executable
-# UNSUPPORTED: system-windows
+# UNSUPPORTED: system-windows, system-cygwin
 # RUN: yaml2obj %s -o %t-universal.o
 
 # RUN: chmod a-x %t-universal.o
diff --git a/llvm/test/tools/llvm-objcopy/ELF/mirror-permissions-unix.test b/llvm/test/tools/llvm-objcopy/ELF/mirror-permissions-unix.test
index 66a481a2230d1be09286bc846d851a48397256c1..13a5382b9d1631cb6eb1b1a9ce7cdb2715bc3e3d 100644
--- a/llvm/test/tools/llvm-objcopy/ELF/mirror-permissions-unix.test
+++ b/llvm/test/tools/llvm-objcopy/ELF/mirror-permissions-unix.test
@@ -5,7 +5,7 @@
 ## llvm-objcopy respects the umask in setting output permissions.
 ## Setting the umask to 0 ensures deterministic permissions across
 ## test environments.
-# UNSUPPORTED: system-windows
+# UNSUPPORTED: system-windows, system-cygwin
 
 # RUN: touch %t
 # RUN: chmod 0777 %t
diff --git a/llvm/test/tools/llvm-objcopy/ELF/respect-umask.test b/llvm/test/tools/llvm-objcopy/ELF/respect-umask.test
index 02e9b93f5376f08d5e01755dae88aa100b7e143d..87d60f6f402cb54b2f644ee380ded70eaf4d3698 100644
--- a/llvm/test/tools/llvm-objcopy/ELF/respect-umask.test
+++ b/llvm/test/tools/llvm-objcopy/ELF/respect-umask.test
@@ -2,7 +2,7 @@
 ## assigning permissions of output files.
 
 ## Windows has no umask so this test makes no sense.
-# UNSUPPORTED: system-windows
+# UNSUPPORTED: system-windows, system-cygwin
 
 # RUN: rm -f %t
 # RUN: touch %t
diff --git a/llvm/test/tools/llvm-objcopy/ELF/strip-preserve-atime.test b/llvm/test/tools/llvm-objcopy/ELF/strip-preserve-atime.test
index c08580f32ecfdf625eef2cb461e9ca68cfb1d055..3b9f37fb499def937327096530b91a74e375f75b 100644
--- a/llvm/test/tools/llvm-objcopy/ELF/strip-preserve-atime.test
+++ b/llvm/test/tools/llvm-objcopy/ELF/strip-preserve-atime.test
@@ -3,7 +3,7 @@
 # Windows: the last access time is disabled by default in the OS
 # This test is also known to fail on Mac (and possibly elsewhere) when Crowdstrike is installed;
 # please make use of the LIT_XFAIL environment variable on such machines.
-# UNSUPPORTED: system-netbsd, system-windows
+# UNSUPPORTED: system-netbsd, system-windows, system-cygwin
 
 # Preserve dates when stripping to an output file.
 # RUN: yaml2obj %s -o %t.1.o
diff --git a/llvm/test/tools/llvm-ranlib/error-opening-permission.test b/llvm/test/tools/llvm-ranlib/error-opening-permission.test
index be56962112e6b63ed9b62cb59238a48d6cee1ac2..947e11d0b559f6d126c57ea02cf80e053767a23a 100644
--- a/llvm/test/tools/llvm-ranlib/error-opening-permission.test
+++ b/llvm/test/tools/llvm-ranlib/error-opening-permission.test
@@ -1,5 +1,5 @@
 ## Unsupported on windows as marking files "unreadable" is non-trivial on windows.
-# UNSUPPORTED: system-windows
+# UNSUPPORTED: system-windows, system-cygwin
 # REQUIRES: non-root-user
 
 # RUN: rm -rf %t && split-file %s %t && cd %t
diff --git a/llvm/test/tools/llvm-rc/windres-preproc.test b/llvm/test/tools/llvm-rc/windres-preproc.test
index 43ed0a61c39d87c6bdbaacb43b47ab5c20c74cfe..7ab7ae9d4406e28609a0c7f02d07f547be0664ab 100644
--- a/llvm/test/tools/llvm-rc/windres-preproc.test
+++ b/llvm/test/tools/llvm-rc/windres-preproc.test
@@ -2,6 +2,9 @@
 ;; invokes the cmd shell to run the commands.
 ; UNSUPPORTED: system-windows
 
+;; Cygwin requires preserving PATH .
+; UNSUPPORTED: system-cygwin
+
 ; RUN: llvm-windres -### --include-dir %p/incdir1 --include %p/incdir2 "-DFOO1=\\\"foo bar\\\"" -UFOO2 -D FOO3 --preprocessor-arg "-DFOO4=\\\"baz baz\\\"" -DFOO5=\"bar\" %p/Inputs/empty.rc %t.res | FileCheck %s --check-prefix=CHECK1
 ; RUN: llvm-windres -### --include-dir %p/incdir1 --include %p/incdir2 "-DFOO1=\"foo bar\"" -UFOO2 -D FOO3 --preprocessor-arg "-DFOO4=\"baz baz\"" "-DFOO5=bar" %p/Inputs/empty.rc %t.res --use-temp-file | FileCheck %s --check-prefix=CHECK1
 ; CHECK1: {{^}} "clang" "--driver-mode=gcc" "-target" "{{.*}}-{{.*}}{{mingw32|cygwin|windows-gnu|windows-cygnus}}" "-E" "-xc" "-DRC_INVOKED" "-I" "{{.*}}incdir1" "-I" "{{.*}}incdir2" "-D" "FOO1=\"foo bar\"" "-U" "FOO2" "-D" "FOO3" "-DFOO4=\"baz baz\"" "-D" "FOO5=bar" "{{.*}}empty.rc" "-o" "{{.*}}preproc-{{.*}}.rc"{{$}}
-- 
2.52.0

