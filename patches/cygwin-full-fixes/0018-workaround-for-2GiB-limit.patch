From 87ba7ffabf0651a35283d2d5ab9cfae71d57b654 Mon Sep 17 00:00:00 2001
From: kikairoya <kikairoya@gmail.com>
Date: Sun, 21 Sep 2025 09:57:11 +0900
Subject: [PATCH 18/39] workaround for 2GiB limit

---
 clang/unittests/CMakeLists.txt             | 4 ++++
 clang/unittests/Interpreter/CMakeLists.txt | 4 ++++
 2 files changed, 8 insertions(+)

diff --git a/clang/unittests/CMakeLists.txt b/clang/unittests/CMakeLists.txt
index 54c781a35c20c7ab1ebbe121783b4b141b467767..0f0b4f98a50d0541dc33a2df5a1d3953d526e6d9 100644
--- a/clang/unittests/CMakeLists.txt
+++ b/clang/unittests/CMakeLists.txt
@@ -126,6 +126,10 @@ add_distinct_clang_unittest(AllClangUnitTests
   ${LLVM_COMPONENTS}
 )
 
+if ((MINGW OR CYGWIN) AND NOT (CLANG_LINK_CLANG_DYLIB OR BUILD_SHARED_LIBS))
+  target_link_options(AllClangUnitTests PRIVATE "-S")
+endif()
+
 # The Tooling library has some internal headers. Make those work. If we like
 # the merged clang unit test binary, we can update the include paths and make
 # this the default.
diff --git a/clang/unittests/Interpreter/CMakeLists.txt b/clang/unittests/Interpreter/CMakeLists.txt
index 66b396b53cb55b728eeb4eb9531c1d0ca4f7e3dc..93813577b748dbf28b0a702bdbd120431b3c9134 100644
--- a/clang/unittests/Interpreter/CMakeLists.txt
+++ b/clang/unittests/Interpreter/CMakeLists.txt
@@ -92,6 +92,10 @@ set_target_properties(ClangReplInterpreterTests PROPERTIES
 )
 endif()
 
+if ((MINGW OR CYGWIN) AND NOT (CLANG_LINK_CLANG_DYLIB OR BUILD_SHARED_LIBS))
+  target_link_options(ClangReplInterpreterTests PRIVATE "-S")
+endif()
+
 # Exceptions on Windows are not yet supported.
 if(NOT WIN32)
   add_subdirectory(ExceptionTests)
-- 
2.51.2

