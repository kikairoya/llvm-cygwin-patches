From 1bcc94c461bf607695325a3c7c61b1c741a08bd0 Mon Sep 17 00:00:00 2001
From: kikairoya <kikairoya@gmail.com>
Date: Sun, 30 Nov 2025 07:43:31 +0900
Subject: [PATCH 16/44] update test

---
 ..._explicit_instantiation.exclude_from_dllimport.cpp | 11 +++++++----
 1 file changed, 7 insertions(+), 4 deletions(-)

diff --git a/clang/test/CodeGenCXX/attr-exclude_from_explicit_instantiation.exclude_from_dllimport.cpp b/clang/test/CodeGenCXX/attr-exclude_from_explicit_instantiation.exclude_from_dllimport.cpp
index dc2099384d398bd7c1b3c20feb35657199a56cb0..ead452e48766cf9592c1fdbf9dbcfa88d9a969fb 100644
--- a/clang/test/CodeGenCXX/attr-exclude_from_explicit_instantiation.exclude_from_dllimport.cpp
+++ b/clang/test/CodeGenCXX/attr-exclude_from_explicit_instantiation.exclude_from_dllimport.cpp
@@ -53,8 +53,8 @@ template <class T> void D<T>::also_to_be_imported() noexcept {}
 template <class T>
 struct E {
   // For the MSVC ABI: this constructor causes implicit instantiation of
-  // the VTable, which should trigger instantiating all virtual member
-  // functions regardless `exclude_from_explicit_instantiation` but currently not.
+  // the VTable, which triggers instantiating all virtual member
+  // functions regardless `exclude_from_explicit_instantiation`.
   // For the Itanium ABI: Emitting the VTable is suppressed by implicit
   // instantiation declaration so virtual member functions won't be instantiated.
   EXCLUDE_FROM_EXPLICIT_INSTANTIATION explicit E(int);
@@ -82,6 +82,8 @@ template <class T> void E<T>::to_be_imported() noexcept {}
 template <class T> void E<T>::to_be_instantiated() noexcept {}
 
 // MSC: $"?not_to_be_imported@?$C@H@@QEAAXXZ" = comdat any
+// MSC: $"?to_be_instantiated@?$E@H@@UEAAXXZ" = comdat any
+// MSC: $"?to_be_instantiated@?$E@I@@UEAAXXZ" = comdat any
 // GNU: $_ZN1CIiE18not_to_be_importedEv = comdat any
 // GNU: @_ZTV1EIiE = external dllimport unnamed_addr
 // GNU: @_ZTV1EIjE = external unnamed_addr
@@ -146,6 +148,7 @@ void use() {
 // MSC: declare dllimport void @"?to_be_imported@?$D@H@@QEAAXXZ"
 // GNU: declare dllimport void @_ZN1DIiE14to_be_importedEv
 
+
 // MSC: declare dllimport void @"?also_to_be_imported@?$D@H@@QEAAXXZ"
 // GNU: declare dllimport void @_ZN1DIiE19also_to_be_importedEv
 
@@ -159,9 +162,9 @@ void use() {
 // GNU: define linkonce_odr dso_local void @_ZN1EIjEC2Ei
 
 // MSC: declare dllimport void @"?to_be_imported@?$E@H@@UEAAXXZ"
-// MSC: declare dso_local void @"?to_be_instantiated@?$E@H@@UEAAXXZ"
+// MSC: define linkonce_odr dso_local void @"?to_be_instantiated@?$E@H@@UEAAXXZ"
 // MSC: declare dllimport void @"?to_be_imported_explicitly@?$E@H@@UEAAXXZ"
 
 // MSC: declare dso_local void @"?to_be_imported@?$E@I@@UEAAXXZ"
-// MSC: declare dso_local void @"?to_be_instantiated@?$E@I@@UEAAXXZ"
+// MSC: define linkonce_odr dso_local void @"?to_be_instantiated@?$E@I@@UEAAXXZ"
 // MSC: declare dllimport void @"?to_be_imported_explicitly@?$E@I@@UEAAXXZ"
-- 
2.51.2

